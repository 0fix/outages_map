<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Outage Map Portugal</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body { font-family: sans-serif; margin: 20px; }
    #map { height: 600px; width: 100%; margin-top: 20px; display: none; }
    select { padding: 8px; font-size: 16px; width: 300px; }
    #spinner {
      margin-top: 20px;
      display: none;
      font-size: 18px;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Outage Map for Portugal</h1>
  <label for="municipality-select">Select Municipality:</label>
  <select id="municipality-select">
    <option value="">-- Choose --</option>
  </select>

  <div id="spinner">ðŸ”„ Loading outagesâ€¦</div>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const OPENCAGE_API_KEY = 'YOUR_API_KEY_HERE'; // Replace with your actual key

    const municipalities = [
  "Abrantes", "Ãgueda", "Aguiar da Beira", "Alandroal", "Albergaria-a-Velha", "Albufeira", "AlcÃ¡cer do Sal",
  "Alcanena", "AlcobaÃ§a", "Alcochete", "Alcoutim", "Alenquer", "AlfÃ¢ndega da FÃ©", "AlijÃ³", "Aljezur",
  "Aljustrel", "Almada", "Almeida", "Almeirim", "AlmodÃ´var", "AlpiarÃ§a", "Alter do ChÃ£o", "AlvaiÃ¡zere",
  "Alvito", "Amadora", "Amarante", "Amares", "Anadia", "Angra do HeroÃ­smo", "AnsiÃ£o", "Arcos de Valdevez",
  "Arganil", "Armamar", "Arouca", "Arraiolos", "Arronches", "Arruda dos Vinhos", "Aveiro", "Avis",
  "Azambuja", "BaiÃ£o", "Barcelos", "Barrancos", "Barreiro", "Batalha", "Beja", "Belmonte", "Benavente",
  "Bombarral", "Borba", "Boticas", "Braga", "BraganÃ§a", "Cabeceiras de Basto", "Cadaval", "Caldas da Rainha",
  "Calheta (AÃ§ores)", "Calheta (Madeira)", "CÃ¢mara de Lobos", "Caminha", "Campo Maior", "Cantanhede",
  "Carrazeda de AnsiÃ£es", "Carregal do Sal", "Cartaxo", "Cascais", "Castanheira de Pera", "Castelo Branco",
  "Castelo de Paiva", "Castelo de Vide", "Castro Daire", "Castro Marim", "Castro Verde", "Celorico da Beira",
  "Celorico de Basto", "Chamusca", "Chaves", "CinfÃ£es", "Coimbra", "Condeixa-a-Nova", "ConstÃ¢ncia",
  "Coruche", "Corvo", "CovilhÃ£", "Crato", "Cuba", "Elvas", "Entroncamento", "Espinho", "Esposende",
  "Estarreja", "Estremoz", "Ã‰vora", "Fafe", "Faro", "Felgueiras", "Ferreira do Alentejo", "Ferreira do ZÃªzere",
  "Figueira da Foz", "Figueira de Castelo Rodrigo", "FigueirÃ³ dos Vinhos", "Fornos de Algodres",
  "Freixo de Espada Ã  Cinta", "Fronteira", "Funchal", "FundÃ£o", "GaviÃ£o", "GÃ³is", "GolegÃ£", "Gondomar",
  "Gouveia", "GrÃ¢ndola", "Guarda", "GuimarÃ£es", "Horta", "Idanha-a-Nova", "Ãlhavo", "Lagoa (AÃ§ores)",
  "Lagoa (Algarve)", "Lagos", "Lajes das Flores", "Lajes do Pico", "Lamego", "Leiria", "Lisboa", "LoulÃ©",
  "Loures", "LourinhÃ£", "LousÃ£", "Lousada", "MaÃ§Ã£o", "Macedo de Cavaleiros", "Machico", "Madalena", "Mafra",
  "Maia", "Mangualde", "Manteigas", "Marco de Canaveses", "Marinha Grande", "MarvÃ£o", "Matosinhos", "Mealhada",
  "MÃªda", "MelgaÃ§o", "MÃ©rtola", "MesÃ£o Frio", "Mira", "Miranda do Corvo", "Miranda do Douro", "Mirandela",
  "Mogadouro", "Moimenta da Beira", "Moita", "MonÃ§Ã£o", "Monchique", "Mondim de Basto", "Monforte",
  "Montalegre", "Montemor-o-Novo", "Montemor-o-Velho", "Montijo", "Mora", "MortÃ¡gua", "Moura", "MourÃ£o",
  "MurÃ§a", "Murtosa", "NazarÃ©", "Nelas", "Nisa", "Nordeste", "Ã“bidos", "Odemira", "Odivelas", "Oeiras",
  "Oleiros", "OlhÃ£o", "Oliveira de AzemÃ©is", "Oliveira de Frades", "Oliveira do Bairro", "Oliveira do Hospital",
  "OurÃ©m", "Ourique", "Ovar", "PaÃ§os de Ferreira", "Palmela", "Pampilhosa da Serra", "Paredes",
  "Paredes de Coura", "PedrÃ³gÃ£o Grande", "Penacova", "Penafiel", "Penalva do Castelo", "Penamacor",
  "Penedono", "Penela", "Peniche", "Peso da RÃ©gua", "Pinhel", "Pombal", "Ponta Delgada", "Ponta do Sol",
  "Ponte da Barca", "Ponte de Lima", "Ponte de Sor", "Portalegre", "Portel", "PortimÃ£o", "Porto",
  "Porto de MÃ³s", "Porto Moniz", "Porto Santo", "PÃ³voa de Lanhoso", "PÃ³voa de Varzim", "PovoaÃ§Ã£o",
  "Praia da VitÃ³ria", "ProenÃ§a-a-Nova", "Redondo", "Reguengos de Monsaraz", "Resende", "Ribeira Brava",
  "Ribeira de Pena", "Ribeira Grande", "Rio Maior", "Sabrosa", "Sabugal", "Salvaterra de Magos",
  "Santa Comba DÃ£o", "Santa Cruz", "Santa Cruz da Graciosa", "Santa Cruz das Flores", "Santa Maria da Feira",
  "Santa Marta de PenaguiÃ£o", "Santana", "SantarÃ©m", "Santiago do CacÃ©m", "Santo Tirso",
  "SÃ£o BrÃ¡s de Alportel", "SÃ£o JoÃ£o da Madeira", "SÃ£o JoÃ£o da Pesqueira", "SÃ£o Pedro do Sul",
  "SÃ£o Roque do Pico", "SÃ£o Vicente", "Sardoal", "SÃ¡tÃ£o", "Seia", "Seixal", "Sernancelhe", "Serpa", "SertÃ£",
  "Sesimbra", "SetÃºbal", "Sever do Vouga", "Silves", "Sines", "Sintra", "Sobral de Monte AgraÃ§o", "Soure",
  "Sousel", "TÃ¡bua", "TabuaÃ§o", "Tarouca", "Tavira", "Terras de Bouro", "Tomar", "Tondela",
  "Torre de Moncorvo", "Torres Novas", "Torres Vedras", "Trancoso", "Trofa", "Vagos", "Vale de Cambra",
  "ValenÃ§a", "Valongo", "ValpaÃ§os", "Velas", "Vendas Novas", "Viana do Alentejo", "Viana do Castelo",
  "Vidigueira", "Vieira do Minho", "Vila de Rei", "Vila do Bispo", "Vila do Conde", "Vila do Porto",
  "Vila Flor", "Vila Franca de Xira", "Vila Franca do Campo", "Vila Nova da Barquinha",
  "Vila Nova de Cerveira", "Vila Nova de FamalicÃ£o", "Vila Nova de Foz CÃ´a", "Vila Nova de Gaia",
  "Vila Nova de Paiva", "Vila Nova de Poiares", "Vila Pouca de Aguiar", "Vila Real",
  "Vila Real de Santo AntÃ³nio", "Vila Velha de RÃ³dÃ£o", "Vila Verde", "Vila ViÃ§osa", "Vimioso", "Vinhais",
  "Viseu", "Vizela", "Vouzela"
];


    const select = document.getElementById("municipality-select");
    municipalities.forEach(m => {
      const option = document.createElement("option");
      option.value = m;
      option.textContent = m;
      select.appendChild(option);
    });

    const map = L.map('map').setView([39.5, -8.0], 7);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);

    const spinner = document.getElementById("spinner");
    const mapDiv = document.getElementById("map");
    const geocodeCache = {};

    function geocode(query, callback) {
      if (geocodeCache[query]) {
        callback(geocodeCache[query]);
        return;
      }

      fetch(`https://api.opencagedata.com/geocode/v1/json?q=${encodeURIComponent(query)}&key=${OPENCAGE_API_KEY}`)
        .then(res => res.json())
        .then(data => {
