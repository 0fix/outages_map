<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Outage Map Portugal</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body { font-family: sans-serif; margin: 20px; }
    #map { height: 600px; width: 100%; margin-top: 20px; }
    select { padding: 8px; font-size: 16px; width: 300px; }
  </style>
</head>
<body>
  <h1>Outage Map for Portugal</h1>
  <label for="municipality-select">Select Municipality:</label>
  <select id="municipality-select">
    <option value="">-- Choose --</option>
  </select>

  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    const OPENCAGE_API_KEY = 'YOUR_API_KEY_HERE'; // Replace with your actual key

    const municipalities = `Abrantes
Águeda
Aguiar da Beira
Alandroal
Albergaria-a-Velha
Albufeira
Alcácer do Sal
Alcanena
Alcobaça
Alcochete
Alcoutim
Alenquer
Alfândega da Fé
Alijó
Aljezur
Aljustrel
Almada
Almeida
Almeirim
Almodôvar
Alpiarça
Alter do Chão
Alvaiázere
Alvito
Amadora
Amarante
Amares
Anadia
Angra do Heroísmo
Ansião
Arcos de Valdevez
Arganil
Armamar
Arouca
Arraiolos
Arronches
Arruda dos Vinhos
Aveiro
Avis
Azambuja
Baião
Barcelos
Barrancos
Barreiro
Batalha
Beja
Belmonte
Benavente
Bombarral
Borba
Boticas
Braga
Bragança
Cabeceiras de Basto
Cadaval
Caldas da Rainha
Calheta (Açores)
Calheta (Madeira)
Câmara de Lobos
Caminha
Campo Maior
Cantanhede
Carrazeda de Ansiães
Carregal do Sal
Cartaxo
Cascais
Castanheira de Pera
Castelo Branco
Castelo de Paiva
Castelo de Vide
Castro Daire
Castro Marim
Castro Verde
Celorico da Beira
Celorico de Basto
Chamusca
Chaves
Cinfães
Coimbra
Condeixa-a-Nova
Constância
Coruche
Corvo
Covilhã
Crato
Cuba
Elvas
Entroncamento
Espinho
Esposende
Estarreja
Estremoz
Évora
Fafe
Faro
Felgueiras
Ferreira do Alentejo
Ferreira do Zêzere
Figueira da Foz
Figueira de Castelo Rodrigo
Figueiró dos Vinhos
Fornos de Algodres
Freixo de Espada à Cinta
Fronteira
Funchal
Fundão
Gavião
Góis
Golegã
Gondomar
Gouveia
Grândola
Guarda
Guimarães
Horta
Idanha-a-Nova
Ílhavo
Lagoa (Açores)
Lagoa (Algarve)
Lagos
Lajes das Flores
Lajes do Pico
Lamego
Leiria
Lisboa
Loulé
Loures
Lourinhã
Lousã
Lousada
Mação
Macedo de Cavaleiros
Machico
Madalena
Mafra
Maia
Mangualde
Manteigas
Marco de Canaveses
Marinha Grande
Marvão
Matosinhos
Mealhada
Mêda
Melgaço
Mértola
Mesão Frio
Mira
Miranda do Corvo
Miranda do Douro
Mirandela
Mogadouro
Moimenta da Beira
Moita
Monção
Monchique
Mondim de Basto
Monforte
Montalegre
Montemor-o-Novo
Montemor-o-Velho
Montijo
Mora
Mortágua
Moura
Mourão
Murça
Murtosa
Nazaré
Nelas
Nisa
Nordeste
Óbidos
Odemira
Odivelas
Oeiras
Oleiros
Olhão
Oliveira de Azeméis
Oliveira de Frades
Oliveira do Bairro
Oliveira do Hospital
Ourém
Ourique
Ovar
Paços de Ferreira
Palmela
Pampilhosa da Serra
Paredes
Paredes de Coura
Pedrógão Grande
Penacova
Penafiel
Penalva do Castelo
Penamacor
Penedono
Penela
Peniche
Peso da Régua
Pinhel
Pombal
Ponta Delgada
Ponta do Sol
Ponte da Barca
Ponte de Lima
Ponte de Sor
Portalegre
Portel
Portimão
Porto
Porto de Mós
Porto Moniz
Porto Santo
Póvoa de Lanhoso
Póvoa de Varzim
Povoação
Praia da Vitória
Proença-a-Nova
Redondo
Reguengos de Monsaraz
Resende
Ribeira Brava
Ribeira de Pena
Ribeira Grande
Rio Maior
Sabrosa
Sabugal
Salvaterra de Magos
Santa Comba Dão
Santa Cruz
Santa Cruz da Graciosa
Santa Cruz das Flores
Santa Maria da Feira
Santa Marta de Penaguião
Santana
Santarém
Santiago do Cacém
Santo Tirso
São Brás de Alportel
São João da Madeira
São João da Pesqueira
São Pedro do Sul
São Roque do Pico
São Vicente
Sardoal
Sátão
Seia
Seixal
Sernancelhe
Serpa
Sertã
Sesimbra
Setúbal
Sever do Vouga
Silves
Sines
Sintra
Sobral de Monte Agraço
Soure
Sousel
Tábua
Tabuaço
Tarouca
Tavira
Terras de Bouro
Tomar
Tondela
Torre de Moncorvo
Torres Novas
Torres Vedras
Trancoso
Trofa
Vagos
Vale de Cambra
Valença
Valongo
Valpaços
Velas
Vendas Novas
Viana do Alentejo
Viana do Castelo
Vidigueira
Vieira do Minho
Vila de Rei
Vila do Bispo
Vila do Conde
Vila do Porto
Vila Flor
Vila Franca de Xira
Vila Franca do Campo
Vila Nova da Barquinha
Vila Nova de Cerveira
Vila Nova de Famalicão
Vila Nova de Foz Côa
Vila Nova de Gaia
Vila Nova de Paiva
Vila Nova de Poiares
Vila Pouca de Aguiar
Vila Real
Vila Real de Santo António
Vila Velha de Ródão
Vila Verde
Vila Viçosa
Vimioso
Vinhais
Viseu
Vizela
Vouzela`.split('\n');

    const select = document.getElementById("municipality-select");
    municipalities.forEach(m => {
      const option = document.createElement("option");
      option.value = m;
      option.textContent = m;
      select.appendChild(option);
    });

    const map = L.map('map').setView([39.5, -8.0], 7);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '© OpenStreetMap contributors'
    }).addTo(map);

    const geocodeCache = {};

    function geocode(zip, callback) {
      if (geocodeCache[zip]) {
        callback(geocodeCache[zip]);
        return;
      }

      fetch(`https://api.opencagedata.com/geocode/v1/json?q=${zip}+Portugal&key=${OPENCAGE_API_KEY}`)
        .then(res => res.json())
        .then(data => {
          if (data.results.length > 0) {
            const coords = [data.results[0].geometry.lat, data.results[0].geometry.lng];
            geocodeCache[zip] = coords;
            callback(coords);
          } else {
            console.warn(`No geocode found for ${zip}`);
          }
        })
        .catch(err => console.error('Geocoding error:', err));
    }

    select.addEventListener("change", ()
